
	
<!DOCTYPE html>
<html>
  <head>
	<link rel="stylesheet" type="text/css" href="stylesheet.css">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Directions service</title>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
    <script>
    var directionsDisplay;
    var directionsService = new google.maps.DirectionsService();
    var map;
    var markerBounds;
    var linesOnMap;
    var regions;

    function initialize() {
      directionsDisplay = new google.maps.DirectionsRenderer();
      var chicago = new google.maps.LatLng(41.850033, -87.6500523);
      var mapOptions = {
        zoom:7,
        center: chicago
      };
      map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
      markerBounds = new google.maps.LatLngBounds();
      directionsDisplay.setMap(map);
      linesOnMap = [];
      regions = [];
      makeRegions();
    } //initialize end

    function calcRoute() {
    	refresh();
    	var travelTime = 0;
    	var coordinates = [];
    	var pointsAndDur = [];
    	var latLongDistDurReg = [];
    	//var hour = document.getElementById('hour').value;
    	var hour = 1;
      	var start = document.getElementById('start').value;
      	var end = document.getElementById('end').value;
      	var request = {
          origin:start,
          destination:end,
          travelMode: google.maps.TravelMode.DRIVING
      	};

      	directionsService.route(request, function(response, status) {
        if (status == google.maps.DirectionsStatus.OK) {
            var stuff;
          	var route = response.routes[0].legs[0];
          	//var step = route.steps[0];
          	var numSteps = route.steps.length;
        	//document.getElementById('s').innerHTML += numSteps;
          	//coordinates = getCoordinates(response.routes[0].legs[0].steps.length,response.routes[0].legs[0]);
          	//travelTime = getTime(coordinates,hour);
    		//pointsAndDist = getAllInfo(coordinates);

    		stuff = getCoordinates(response.routes[0].legs[0].steps.length,response.routes[0].legs[0]);
    		
    		latLongDistDurReg = stuff[0];
    		coordinates = stuff[1];
    		pointsAndDur = stuff[2];
    		travelTime = getTime(pointsAndDur,hour);
    		//travelTime = getTime(latLongDistDurReg);
          	
          	//document.getElementById('duration').innerHTML += pointsAndDur;
          	//document.getElementById('tot').innerHTML += response.routes[0].legs[0].distance.value;
          	//document.getElementById('h').innerHTML += hour;
          	//document.getElementById('inst').innerHTML += step.instructions;
          	//document.getElementById('StPa').innerHTML += step.path;
          	//document.getElementById('coord').innerHTML += latLongDistDurReg;

          	drawLines(latLongDistDurReg);
          	createMarkers(coordinates);
          	map.fitBounds(markerBounds);
          	document.getElementById('finalTravel').innerHTML = "Travel time: " + travelTime;
          	//directionsDisplay.setDirections(response);
        }
      }); //callback for directionsServices end

    } //calcRoute end

    function drawLines(info) { 
    	
    	var pathCoords;
    	var color;
    	var line;

    	for (i = 0; i < info.length - 1; i++) {
    		pathCoords = [info[i][0],info[i+1][0]];
    		/*
    		for (j = 0; j < regions.length; j++) {
    			if (google.maps.geometry.poly.containsLocation(info[i][0],regions[j])) {
    				color = '#000000';
    				break;
    			} else if (google.maps.geometry.poly.containsLocation(info[i][0],poly2)) {
    				color = '#FF0000';
    			}
    		}
    		*/
    		color = '#FF0000';
    		line = new google.maps.Polyline({
    		    path: pathCoords,
    		    geodesic: true,
    		    strokeColor: color,
    		    strokeOpacity: 1.0,
    			strokeWeight: 2
    		});
    		line.setMap(map);
    		linesOnMap.push(line);
    	}
    }

    function createMarkers(coords) {
    	for (i = 0; i < coords.length; i++) {
    		markerBounds.extend(coords[i]);
    	}
    }

    function makeRegions() {
    	var coords1 = [new google.maps.LatLng(41.88, -86.62),new google.maps.LatLng(42.8818, -86.62),new google.maps.LatLng(42.8818, -88.62),new google.maps.LatLng(41.88, -88.62)];
    	var coords2 = [new google.maps.LatLng(41.88, -86.62),new google.maps.LatLng(40.8818, -86.62),new google.maps.LatLng(40.8818, -88.62),new google.maps.LatLng(41.88, -88.62)];
    	var poly1 = new google.maps.Polygon({
    	    paths: coords1,
    	    strokeColor: '#0000FF',
    	    strokeOpacity: 0.8,
    	    strokeWeight: 3,
    	    fillColor: '#0000FF',
    	    fillOpacity: 0.35
    	  });
    	var poly2 = new google.maps.Polygon({
    	    paths: coords2,
    	    strokeColor: '#00FF00',
    	    strokeOpacity: 0.8,
    	    strokeWeight: 3,
    	    fillColor: '#00FF00',
    	    fillOpacity: 0.35
    	  });
    	  //poly1.setMap(map);
    	  regions.push(poly1);
    	  //poly2.setMap(map);
    	  regions.push(poly2);
    }

    /*
    function getAllInfo(coords) {
    	temp = [];
    	for (i = 0; i < coords.length - 1;i++) {
    		temp.push([coords[i],distance(coords[i],coords[i+1])]);
    	}
    	//since the previous for loop doesn't include last point:
    	temp.push([coords[coords.length - 1],0]);
    	return temp;
    }
    */

    function getTime(list, timeOfDay) {
    	var time = 0;
    	for (i = 0; i < list.length;i++) {
    		t = trafficTime(list[i][0], list[i][1], timeOfDay);
    		time += t;
    		//TODO: need to somehow to add passing time to next stretch
    		//timeOfDay += t; 
    	}
    	return time;
    } //getTime end

    function getCoordinates(numberOfSteps, theRoute) {
    	
    	var latLongDistDurReg = [];
    	var justCoordinates = [];
    	var pAndD = [];
    	var everything = [];
    	var step;
    	var durat;
    	var length;
    	var dist;
    	var dur;
    	var regNum;
    	var c = 0.000621371; //constant to convert from meters to miles

    	for (i = 0; i < theRoute.steps.length;i++){
        	step = theRoute.steps[i];   	
        	
        	durat = step.duration.value; // in seconds
        	length = step.distance.value; // in meters

    		for (j = 0; j < step.path.length-1;j++) {
    			dist = distance(step.path[j],step.path[j+1]); // in miles
    			dur = (dist/(c*length))*durat; // in seconds
    			/*
    			for (k = 0; k < regions.length;k++) {
    				if (google.maps.geometry.poly.containsLocation(step.path[j],regions[k])) {
    					regNum = k;
    					break;
    				}
    			}
    			*/
    			regNum = 0;
    			latLongDistDurReg.push([step.path[j],dist,dur, regNum]);
    			justCoordinates.push(step.path[j]);
    			
    			pAndD.push([step.path[j], dur]);
    			//dur is time from this point to next

    			
    		}
    		
    		latLongDistDurReg.push([step.path[step.path.length-1],0,0]);
    		justCoordinates.push(step.path[step.path.length-1]);
    		pAndD.push([step.path[step.path.length-1],0]);
    		
      	}
      	everything.push(latLongDistDurReg);
      	everything.push(justCoordinates);
      	everything.push(pAndD);
      	return everything;
    } //getCoordinates end


    function trafficTime(start, normalTime, hour) {
    	
    	return normalTime;
    } //trafficTime end

    function refresh() {
    	markerBounds = new google.maps.LatLngBounds();
    	//document.getElementById('s').innerHTML = "Number of Steps: ";
    	//document.getElementById('duration').innerHTML = "Duration: ";
        //document.getElementById('tot').innerHTML = "Total Length: ";
        //document.getElementById('h').innerHTML = "hour: ";
        //document.getElementById('inst').innerHTML = "Last Step Instructions: ";
        //document.getElementById('StPa').innerHTML = "Last Step Path: ";
        //document.getElementById('coord').innerHTML = "Coordinates: ";

        for (i = 0; i < linesOnMap.length;i++) {
    		linesOnMap[i].setMap(null);
        }
        linesOnMap = [];
        
    } //refresh end


    function distance(point1, point2) {
    	var lat1 = point1.lat();
    	var lat2 = point2.lat();
    	var lon1 = point1.lng();
    	var lon2 = point2.lng();
    	
    	var R = 6371; // km
    	var M = 0.621371; //and then back to miles
    	var phi1 = toRadian(lat1);
    	
    	var phi2 = toRadian(lat2);
    	var dPhi = toRadian(lat2-lat1);
    	var dLambda = toRadian(lon2-lon1);
    	
    	var a = Math.sin(dPhi/2) * Math.sin(dPhi/2) +
    	        Math.cos(phi1) * Math.cos(phi2) *
    	        Math.sin(dLambda/2) * Math.sin(dLambda/2);
    	var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    	return R * c * M;
    } //distance end

    function toRadian(degrees) {
    	return degrees * Math.PI / 180;
    } //toRadian end

    google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </head>
  <body>
	<div class = "header">
		<img class = "logo" src = "GetMeThere.png">
    </div>
    
    <div id="panel">
    <b>Start: </b>
    <select id="start" onchange="calcRoute();">
      <option value="Rogers Park - West Ridge, Chicago">Rogers Park - West Ridge</option>
      <option value="Far North West, Chicago">Far North West, Chicago</option>
      <option value="North Park-Albany-Lincoln Square, Chicago">North Park-Albany-Lincoln Square</option>
      <option value="Edge Water- Uptown, Chicago">Edge Water- Uptown</option>
      <option value="Dunning-Portage-Belmont Cragn, Chicago">Dunning-Portage-Belmont Cragn</option>
      <option value="Irving Park-Avondale-North Ctr, Chicago">Irving Park-Avondale-North Ctr</option>
      <option value="Hermosa-Logan Square, Chicago">Hermosa-Logan Square</option>
      <option value="Lincoln Park-lake View, Chicago">Lincoln Park-lake View</option>
      <option value="Austin, Chicago, Chicago">Austin, Chicago</option>
      <option value="Humboldt - Garfield Park E/W, Chicago">"Humboldt - Garfield Park E/W"</option>
      <option value="West Town-Near West, Chicago">West Town-Near West</option>
      <option value="Near North, Chicago">Near North, Chicago</option>
      <option value="Chicago Loop">Chicago Loop</option>
      <option value="Lawndale N/S, Chicago">Lawndale N/S</option>
      <option value="Bridgeport-McKinley-Lower West, Chicago">Bridgeport-McKinley-Lower West</option>
      <option value="Near South-Douglas, Chicago">Near South-Douglas</option>
      <option value="Midway-Garfield Rdge-Clearing, Chicago">Midway-Garfield Rdge-Clearing</option>
      <option value="South West Side, Chicago, Chicago">South West Side, Chicago</option>
      <option value="New City-Englewood-West Englewood, Chicago">New City-Englewood-West Englewood</option>
      <option value="Fuller- Grand Blvd-Washington Park, Chicago">Fuller- Grand Blvd-Washington Park</option>
      <option value="Hyde Park- Kenwood-Woodlawn, Chicago">Hyde Park- Kenwood-Woodlawn</option>
      <option value="Ashburn, Chicago, Chicago">Ashburn, Chicago</option>
      <option value="Auburn Gresham - Chatham, Chicago">Auburn Gresham - Chatham</option>
      <option value="South Shore-S Chicago- Avlon, Chicago">South Shore-S Chicago- Avlon</option>
      <option value="Beverly-Mountain Greenwood- Morgan Park, Chicago">Beverly-Mountain Greenwood- Morgan Park</option>
      <option value="Washington Hts-Roseland-Pullman, Chicago">Washington Hts-Roseland-Pullman</option>
      <option value="South Deering- East Side, Chicago">South Deering- East Side</option>
      <option value="Riverdale-Hegewisch, Chicago">Riverdale-Hegewisch</option>
      <option value="Downtown Lakefront, Chicago">Downtown Lakefront</option>
    </select>
    <b>End: </b>
    <select id="end" onchange="calcRoute();">
      <option value="Rogers Park - West Ridge, Chicago">Rogers Park - West Ridge</option>
      <option value="Far North West, Chicago">Far North West, Chicago</option>
      <option value="North Park-Albany-Lincoln Square, Chicago">North Park-Albany-Lincoln Square</option>
      <option value="Edge Water- Uptown, Chicago">Edge Water- Uptown</option>
      <option value="Dunning-Portage-Belmont Cragn, Chicago">Dunning-Portage-Belmont Cragn</option>
      <option value="Irving Park-Avondale-North Ctr, Chicago">Irving Park-Avondale-North Ctr</option>
      <option value="Hermosa-Logan Square, Chicago">Hermosa-Logan Square</option>
      <option value="Lincoln Park-lake View, Chicago">Lincoln Park-lake View</option>
      <option value="Austin, Chicago, Chicago">Austin, Chicago</option>
      <option value="Humboldt - Garfield Park E/W, Chicago">"Humboldt - Garfield Park E/W"</option>
      <option value="West Town-Near West, Chicago">West Town-Near West</option>
      <option value="Near North, Chicago">Near North, Chicago</option>
      <option value="Chicago Loop">Chicago Loop</option>
      <option value="Lawndale N/S, Chicago">Lawndale N/S</option>
      <option value="Bridgeport-McKinley-Lower West, Chicago">Bridgeport-McKinley-Lower West</option>
      <option value="Near South-Douglas, Chicago">Near South-Douglas</option>
      <option value="Midway-Garfield Rdge-Clearing, Chicago">Midway-Garfield Rdge-Clearing</option>
      <option value="South West Side, Chicago, Chicago">South West Side, Chicago</option>
      <option value="New City-Englewood-West Englewood, Chicago">New City-Englewood-West Englewood</option>
      <option value="Fuller- Grand Blvd-Washington Park, Chicago">Fuller- Grand Blvd-Washington Park</option>
      <option value="Hyde Park- Kenwood-Woodlawn, Chicago">Hyde Park- Kenwood-Woodlawn</option>
      <option value="Ashburn, Chicago, Chicago">Ashburn, Chicago</option>
      <option value="Auburn Gresham - Chatham, Chicago">Auburn Gresham - Chatham</option>
      <option value="South Shore-S Chicago- Avlon, Chicago">South Shore-S Chicago- Avlon</option>
      <option value="Beverly-Mountain Greenwood- Morgan Park, Chicago">Beverly-Mountain Greenwood- Morgan Park</option>
      <option value="Washington Hts-Roseland-Pullman, Chicago">Washington Hts-Roseland-Pullman</option>
      <option value="South Deering- East Side, Chicago">South Deering- East Side</option>
      <option value="Riverdale-Hegewisch, Chicago">Riverdale-Hegewisch</option>
      <option value="Downtown Lakefront, Chicago">Downtown Lakefront</option>
    </select>

    <b id="finalTravel">Hello!</b>
 
    </div>
    <div id="map-canvas"></div>
  </body>
</html>